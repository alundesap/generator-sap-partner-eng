## Generated mta.yaml based on yo sap-partner-eng version <%= package_version %>
## appName = <%= app_name %>
## language=nodejs; multiTenant=false
## approuter=<%= router_name %>
_schema-version: '3.1'
ID: <%= app_name %>
version: 0.0.1
description: <%= app_desc %>
parameters:
   enable-parallel-deployments: true
  
  
#build-parameters:
#  before-all:
#   - builder: custom
#     commands:
#      - npm install
#      - npx cds build

modules:

### New Modules Here ###

# cf push <%= router_name %> -p <%= router_dir %> -n <%= router_name %> -d <%= domain_name %> -k 256M -m 256M
 - name: <%= router_name %>
   type: html5
   path: <%= router_dir %>
   build-parameters:
      ignore: ["node_modules/"]
   parameters:
      #host: your_org-${space}-<%= router_name %>
      #domain: <%= domain_name %>
      #routes:
      #  - route: <%= router_name %>-${space}-${app-name}.${default-domain}
      disk-quota: 256M
      memory: 256M
   provides:
    - name: Router_api
      properties:
         url: ${default-url}
         application: ${app-name}
# CDS-MTX
#   properties:
#      TENANT_HOST_PATTERN: '^(.*).<%= domain_name %>'
   requires:
   # cf bind-service <%= router_name %> <%= uaa_svc_name %>
    - name: <%= uaa_res_name %>
   ### New Destinations Here ###

resources:

### New Resources Here ###

# cf create-service xsuaa application <%= uaa_svc_name %> -c ./cds-security.json
 - name: <%= uaa_res_name %>
   type: org.cloudfoundry.managed-service
   requires:
    - name: Router_api
   properties:
      THEXSAPPNAME: ${xsuaa-app}
   parameters:
      # Re-run the following command after changing any @(requires: []) definitions in srv/*.cds
      # Run this from the root of the project and uncomment the path:
      # cds compile srv/ --to xsuaa,json > cds-security.json
      #path: ./cds-security.json
      service-plan: application
      service: xsuaa
      service-name: <%= uaa_svc_name %>
      xsuaa-app: ${space}-~{Router_api/application}
      # Define within config what used to be in the xs-security.json file.  path: now pulls in cds scopes/role templates
      # Convert with https://www.json2yaml.com/
      # https://github.wdf.sap.corp/pages/cap/guides/authorization#role-assignments-with-xsuaa
      config:
         xsappname: <%= app_name %>
         tenant-mode: dedicated
         # tenant-mode: shared
         description: Security profile of the <%= app_name %> application
         scopes:
          - name: "$XSAPPNAME.Callback"
            description: With this scope set, the callbacks for tenant onboarding, offboarding and getDependencies can be called.
            grant-as-authority-to-apps: 
             - "$XSAPPNAME(application,sap-provisioning,tenant-onboarding)"
          - name: uaa.user
            description: UAA
         role-templates:
          - name: Token_Exchange
            description: UAA
            scope-references:
             - uaa.user
         oauth2-configuration:
            redirect-uris: 
             - "http*://*.<%= domain_name %>/**"

# CAP-MTX Managed HANA (Internal Service Manager)
# - name: <%= app_name %>-mgd
#   type: org.cloudfoundry.managed-service
#   requires:
#    - name: <%= app_name %>_srv_api
#   parameters:
#      service-plan: hdi-shared
#      service: managed-hana
#      service-name: <%= app_name %>_MGD

# CAP-MXT Registration
# - name: <%= app_name %>-reg
#   type: org.cloudfoundry.managed-service
#   requires:
#    - name: <%= app_name %>-uaa
#   parameters:
#    service: saas-registry
#    service-plan: application
#    service-name: <%= app_name %>_REG
#    config:
#      xsappname: ~{<%= app_name %>-uaa/THEXSAPPNAME}
#      appName: <%= app_name %>
#      displayName: <%= app_name %>
#      description: '<%= app_name %> Multitenant App'
#      category: '<%= app_name %> Category'
#      appUrls:
#         onSubscription: https://<%= app_name %>-srv-${space}.<%= domain_name %>/mtx/v1/provisioning/tenant/{tenantId}

